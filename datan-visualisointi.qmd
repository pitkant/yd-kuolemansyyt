---
title: "YP YD-visualisoinnit"
date: 2025-09-30
format: pdf
tbl-colwidths: true
---

# 0. Relevanttien pakettien lataaminen

```{r}
library(pxweb)
library(ggplot2)
library(dplyr)
library(tidyr)
library(janitor)
```

# 0.1 Datan hakeminen

```{r 0_datan_hakeminen}
pxweb_query_list <- 
  list("Tilaston peruskuolemansyy (aikasarjaluokitus)"=c("SSS", "50","51"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=c("1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023"),
       "Tiedot"=c("ksyylkm"))

px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/ksyyt/statfin_ksyyt_pxt_11az.px",
            query = pxweb_query_list)

statfin_ksyyt_pxt_11az <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")

pxweb_query_list <- 
  list("Tilaston peruskuolemansyy (ICD-10, 3-merkkitaso)"=c("F11","F12", "F14", "F15",
                                                            "F16", "F19", "X41", "X42", "X44",
                                                            "X61", "X62", "X64", "Y11", "Y12", "Y14"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=c("1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023"),
       "Tiedot"=c("ksyylkm"))

# Ilman itsemurhia
pxweb_query_list <- 
  list("Tilaston peruskuolemansyy (ICD-10, 3-merkkitaso)"=c("F11","F12", "F14", "F15",
                                                            "F16", "F19", "X41", "X42", "X44",
                                                            "Y11", "Y12", "Y14"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=c("1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023"),
       "Tiedot"=c("ksyylkm"))

px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/ksyyt/statfin_ksyyt_pxt_11be.px",
            query = pxweb_query_list)

statfin_ksyyt_pxt_11be <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")

pxweb_query_list <- 
  list("Huume (B-luokitus)"=c("SSS"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=c("2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023"),
       "Tiedot"=c("ksyylkm15"))

px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/ksyyt/statfin_ksyyt_pxt_12d9.px",
            query = pxweb_query_list)

statfin_ksyyt_pxt_12d9 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")
```

## Väestön määrä

```{r vaestotietojen-hakeminen}
# PXWEB query 
pxweb_query_list <- 
  list("Vuosi"=c("1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023","2024"),
       "Sukupuoli"=c("SSS","1","2"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Tiedot"=c("vaesto"))

# Download data 
px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/vaerak/statfin_vaerak_pxt_11rc.px",
            query = pxweb_query_list)

# Convert to data.frame 
statfin_vaerak_pxt_11rc <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")


```

```
############# CITATION #############Statistics Finland (2025). “Väestö 31.12.
muuttujina Vuosi, Sukupuoli, Ikä ja Tiedot.”
[Data accessed 2025-09-30 13:07:45.039348
using pxweb R package 0.17.1],
<https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/vaerak/statfin_vaerak_pxt_11rc.px>.

A BibTeX entry for LaTeX users is

  @Misc{,
    title = {Väestö 31.12. muuttujina Vuosi, Sukupuoli, Ikä ja Tiedot},
    author = {{Statistics Finland}},
    organization = {Statistics Finland},
    address = {Helsinki, Finland},
    year = {2025},
    url = {https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/vaerak/statfin_vaerak_pxt_11rc.px},
    note = {[Data accessed 2025-09-30 13:07:45.039348 using pxweb R package 0.17.1]},
  }
```

## Filtteröinti

```{r 0_yd_yleinen_filtterointi}
statfin_ksyyt_pxt_11az <- statfin_ksyyt_pxt_11az %>% 
  janitor::clean_names()

itsemurhat_vakivalta <- statfin_ksyyt_pxt_11az %>% 
  # filter(sukupuoli %in% c("Miehet", "Naiset"), as.numeric(vuosi) >= 2006) %>% 
  # filter(!(tilaston_peruskuolemansyy_aikasarjaluokitus %in% "00-54 Yhteensä")) %>% 
  group_by(tilaston_peruskuolemansyy_aikasarjaluokitus, vuosi, ika, sukupuoli) %>% 
  summarize(kuolleet_06_23 = sum(kuolleet)) %>% 
  mutate(kuolemansyy = case_when(
    tilaston_peruskuolemansyy_aikasarjaluokitus == "50 Itsemurhat (X60-X84, Y870)" ~ "itsemurha",
    tilaston_peruskuolemansyy_aikasarjaluokitus == "51 Murha, tappo tai muu tahallinen pahoinpitely (X85-Y09, Y871)" ~ "vakivalta",
    .default = "muut"
  )) %>% 
  ungroup() %>% 
  select(vuosi, ika, sukupuoli, kuolleet_06_23, kuolemansyy)

statfin_ksyyt_pxt_12d9 <- statfin_ksyyt_pxt_12d9 %>% 
  janitor::clean_names()

huumekuolemat <- statfin_ksyyt_pxt_12d9 %>% 
  # filter(sukupuoli %in% c("Miehet", "Naiset"), as.numeric(vuosi) >= 2006) %>% 
  group_by(vuosi, ika, sukupuoli) %>% 
  summarize(kuolleet_06_23 = sum(huumeisiin_kuolleet_b_luokitus, na.rm = TRUE)) %>% 
  ungroup() %>% 
  mutate(kuolemansyy = "huumekuolema")
```


# 1. 3x pylväsdiagrammi yd-kuolemansyyn (itsemurhat, huumeet, väkivalta) 

## Filtteröinti

```{r 1_yd_kuolemansyyt_filtterointi}
itsemurhat_ikaryhmat <- itsemurhat_vakivalta %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(kuolemansyy == "itsemurha") %>% 
  filter(sukupuoli == "Yhteensä")

vakivalta_ikaryhmat <- itsemurhat_vakivalta %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(kuolemansyy == "vakivalta") %>% 
  filter(sukupuoli == "Yhteensä")

huumekuolemat_ikaryhmat <- huumekuolemat %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli == "Yhteensä")

```
## Visualisointi

```{r 1_yd_kuolemansyyt_visualisointi}
ggplot(itsemurhat_ikaryhmat, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Itsemurhiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä")

ggplot(vakivalta_ikaryhmat, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Väkivaltaan kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä")

ggplot(huumekuolemat_ikaryhmat, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Huumeisiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä")
```
# 2. Pylväsdiagrammi, yd-kuolemansyyt sukupuolittain 2006-2024, absoluuttiset luvut

## Filtteröinti

```{r 2_yd_kuolemansyyt_sukupuolittain_filtterointi}
itsemurhat_sp <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli) %>% 
  summarize(kuolleet_06_23_sp = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_sp <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli) %>% 
  summarize(kuolleet_06_23_sp = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_sp <- huumekuolemat %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli) %>% 
  summarize(kuolleet_06_23_sp = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()
```

## Visualisointi

```{r 2_yd_kuolemansyyt_sukupuolittain_visualisointi}
ggplot(itsemurhat_sp, aes(fill = sukupuoli, y=kuolleet_06_23_sp, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Itsemurhiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Sukupuoli")

ggplot(vakivalta_sp, aes(fill = sukupuoli, y=kuolleet_06_23_sp, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Väkivaltaan kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Sukupuoli")

ggplot(huumekuolemat_sp, aes(fill = sukupuoli, y=kuolleet_06_23_sp, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Huumeisiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Sukupuoli")
```

# 3. Pylväsdiagrammi, jossa 15-29-vuotiaiden nuorten kuolemat 2006-2024

## Filtteröinti

```{r 3_yd_kuolemansyyt_vs_muut_filtterointi}
itsemurhat_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki_muut_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "muut") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% "Yhteensä") %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_yht <- huumekuolemat %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki <- rbind(itsemurhat_yht, vakivalta_yht, huumekuolemat_yht, kaikki_muut_yht)

kaikki_wide <- kaikki %>% 
  pivot_wider(names_from = kuolemansyy, values_from = kuolleet_06_23_yht) %>% 
  mutate(muut = muut - itsemurha - vakivalta - huumekuolema)

kaikki_long <- kaikki_wide %>% 
  pivot_longer(!c(vuosi, sukupuoli), names_to = "kuolemansyy")

```

## Visualisointi

```{r 3_yd_kuolemansyyt_vs_muut_visualisointi}
ggplot(kaikki_long, aes(fill = kuolemansyy, y=value, x=as.numeric(vuosi))) +
  geom_bar(position="stack", stat="identity") + 
  labs(title = "Eri syistä kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az, statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Kuolemansyy")
```

# 4. Viivadiagrammi nuorten kuolemista 1970-2024, yd-kuolemansyyt ja kaikki kuolemansyyt.

## Filtteröinti

```{r 4_yd_kuolemansyyt_vs_muut_1970_filtterointi}
itsemurhat_yht_70 <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_yht_70 <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki_muut_yht_70 <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "muut") %>% 
  filter(sukupuoli %in% "Yhteensä") %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_yht_70 <- huumekuolemat %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki_70 <- rbind(itsemurhat_yht_70, vakivalta_yht_70, huumekuolemat_yht_70, kaikki_muut_yht_70)

# kaikki_wide_70 <- kaikki_70 %>%
#   pivot_wider(names_from = kuolemansyy, values_from = kuolleet_yht) %>%
#   mutate(muut = muut - itsemurha - vakivalta - huumekuolema)
# 
# kaikki_long_70 <- kaikki_wide_70 %>%
#   pivot_longer(!c(vuosi, sukupuoli), names_to = "kuolemansyy")

```


## Visualisointi

```{r 4_yd_kuolemansyyt_vs_muut_1970_visualisointi}
ggplot(data = kaikki_70, aes(x = as.numeric(vuosi), y = kuolleet_yht, group = kuolemansyy)) +
  geom_line(aes(color=kuolemansyy))
```


# Session info

Tällä varmistetaan se, että tieto pakettien versioista tulee kirjattua johonkin.

```{r}
sessionInfo()
```

