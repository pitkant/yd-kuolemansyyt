---
title: "YP YD-visualisoinnit"
date: 2025-09-30
format: 
  pdf:
    df-print: kable
execute: 
  echo: true
  warning: false
  error: false
---

# 0. Relevanttien pakettien lataaminen

Tilastotietojen lataamisessa Tilastokeskuksen StatFin-tietokannasta käytetään [pxweb-pakettia](https://ropengov.github.io/pxweb/). Paketti mahdollistaa hakujen tekemisen tekstipohjaisesta käyttöliittymästä, jolloin haut ovat tallennettavissa, helposti toistettavissa ja muokattavissa suoraan R:stä. `pxweb`-paketti toimii monien eri pxweb-tietokantojen kanssa eri maissa.

Datan käsittelyyn (data wrangling) käytetään [tidyverseen](https://www.tidyverse.org) kuuluvia `ggplot2`-, `dplyr`- ja `tidyr`-paketteja.

Datasettien nimien siivoamiseen käytetään `janitor`-pakettia.

Kuvien yhdistämiseksi paneelikuviksi hyödynnetään `patchwork`-pakettia.

```{r}
library(pxweb)
library(ggplot2)
library(dplyr)
library(tidyr)
library(janitor)
library(patchwork)
```

# 0.1 Datan hakeminen

```{r 0_datan_hakeminen}
pxweb_query_list <- 
  list("Tilaston peruskuolemansyy (aikasarjaluokitus)"=c("SSS", "50","51"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=as.character(1969:2023),
       "Tiedot"=c("ksyylkm"))

px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/ksyyt/statfin_ksyyt_pxt_11az.px",
            query = pxweb_query_list)

statfin_ksyyt_pxt_11az <- as.data.frame(px_data,
                                        column.name.type = "text",
                                        variable.value.type = "text")

pxweb_query_list <- 
  list("Tilaston peruskuolemansyy (ICD-10, 3-merkkitaso)"=c("F11","F12", "F14",
                                                            "F15", "F16", "F19", 
                                                            "X41", "X42", "X44",
                                                            "X61", "X62", "X64", 
                                                            "Y11", "Y12", "Y14"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=as.character(1998:2023),
       "Tiedot"=c("ksyylkm"))

# Huumausainekuolemat ICD-10 -koodeilla, ilman itsemurhia
pxweb_query_list <- 
  list("Tilaston peruskuolemansyy (ICD-10, 3-merkkitaso)"=c("F11","F12", "F14", 
                                                            "F15", "F16", "F19", 
                                                            "X41", "X42", "X44",
                                                            "Y11", "Y12", "Y14"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=as.character(1998:2023),
       "Tiedot"=c("ksyylkm"))

px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/ksyyt/statfin_ksyyt_pxt_11be.px",
            query = pxweb_query_list)

statfin_ksyyt_pxt_11be <- as.data.frame(px_data,
                                        column.name.type = "text",
                                        variable.value.type = "text")

pxweb_query_list <- 
  list("Huume (B-luokitus)"=c("SSS"),
       "Ikä"=c("15-19","20-24","25-29"),
       "Sukupuoli"=c("SSS","1","2"),
       "Vuosi"=as.character(2006:2023),
       "Tiedot"=c("ksyylkm15"))

px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/ksyyt/statfin_ksyyt_pxt_12d9.px",
            query = pxweb_query_list)

statfin_ksyyt_pxt_12d9 <- as.data.frame(px_data,
                                        column.name.type = "text",
                                        variable.value.type = "text")
```

## Keskiväkiluku

```{r vaestotietojen_hakeminen}
# PXWEB query 
pxweb_query_list <- 
  list("Alue"="SSS",
       "Vuosi"=as.character(1981:2024),
       "Sukupuoli"=c("SSS","1","2"),
       "Ikä"=paste0("0", 15:29),
       "Tiedot"=c("keskiv"))

# Download data 
px_data <- 
  pxweb_get(url = "https://statfin.stat.fi/PXWeb/api/v1/fi/StatFin/vaerak/statfin_vaerak_pxt_11s1.px",
            query = pxweb_query_list)

# Convert to data.frame 
statfin_vaerak_pxt_11s1 <- as.data.frame(px_data,
                                         column.name.type = "text",
                                         variable.value.type = "text")
```

## Filtteröinti

`janitor`-paketin `clean_names()`-funktiolla muutetaan suomenkieliset muuttujanimet helpommin käsiteltäviksi ASCII-nimiksi, joissa poistetaan isot kirjaimet, välilyönnit korvataan _-merkillä, ääkköset poistetaan ym.

Muodostetaan uusi muuttuja "kuolemansyy" jota voidaan käyttää eri kuolemansyiden lukujen ryhmittelyyn visualisoinneissa.

```{r 0_yd_yleinen_filtterointi}
statfin_ksyyt_pxt_11az <- statfin_ksyyt_pxt_11az %>% 
  janitor::clean_names()

itsemurhat_vakivalta <- statfin_ksyyt_pxt_11az %>% 
  # filter(sukupuoli %in% c("Miehet", "Naiset"), as.numeric(vuosi) >= 2006) %>% 
  # filter(!(tilaston_peruskuolemansyy_aikasarjaluokitus %in% "00-54 Yhteensä")) %>% 
  group_by(tilaston_peruskuolemansyy_aikasarjaluokitus, vuosi, ika, sukupuoli) %>% 
  summarize(kuolleet_06_23 = sum(kuolleet)) %>% 
  mutate(kuolemansyy = case_when(
    tilaston_peruskuolemansyy_aikasarjaluokitus == "50 Itsemurhat (X60-X84, Y870)" ~ "itsemurha",
    tilaston_peruskuolemansyy_aikasarjaluokitus == "51 Murha, tappo tai muu tahallinen pahoinpitely (X85-Y09, Y871)" ~ "vakivalta",
    .default = "muut"
  )) %>% 
  ungroup() %>% 
  select(vuosi, ika, sukupuoli, kuolleet_06_23, kuolemansyy)

statfin_ksyyt_pxt_12d9 <- statfin_ksyyt_pxt_12d9 %>% 
  janitor::clean_names()

huumekuolemat <- statfin_ksyyt_pxt_12d9 %>% 
  # filter(sukupuoli %in% c("Miehet", "Naiset"), as.numeric(vuosi) >= 2006) %>% 
  group_by(vuosi, ika, sukupuoli) %>% 
  summarize(kuolleet_06_23 = sum(huumeisiin_kuolleet_b_luokitus, na.rm = TRUE)) %>% 
  ungroup() %>% 
  mutate(kuolemansyy = "huumekuolema")
```


# 1. 3x pylväsdiagrammi yd-kuolemansyyn (itsemurhat, huumeet, väkivalta) 

## Filtteröinti

```{r 1_yd_kuolemansyyt_filtterointi}
itsemurhat_ikaryhmat <- itsemurhat_vakivalta %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(kuolemansyy == "itsemurha") %>% 
  filter(sukupuoli == "Yhteensä")

vakivalta_ikaryhmat <- itsemurhat_vakivalta %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(kuolemansyy == "vakivalta") %>% 
  filter(sukupuoli == "Yhteensä")

huumekuolemat_ikaryhmat <- huumekuolemat %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli == "Yhteensä")

itsemurhat_ikaryhmat_total <- itsemurhat_ikaryhmat %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23 = sum(kuolleet_06_23)) %>% 
  mutate(ika = "15 - 29 (Yhteensä)") %>% 
  select(vuosi, ika, sukupuoli, kuolleet_06_23, kuolemansyy)

vakivalta_ikaryhmat_total <- vakivalta_ikaryhmat %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23 = sum(kuolleet_06_23)) %>% 
  mutate(ika = "15 - 29 (Yhteensä)") %>% 
  select(vuosi, ika, sukupuoli, kuolleet_06_23, kuolemansyy)

huumekuolemat_ikaryhmat_total <- huumekuolemat_ikaryhmat %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23 = sum(kuolleet_06_23)) %>% 
  mutate(ika = "15 - 29 (Yhteensä)") %>% 
  select(vuosi, ika, sukupuoli, kuolleet_06_23, kuolemansyy)
```

Muutetaan ika-muuttujan character-arvot faktoreiksi, jolloin voidaan määritellä manuaalisesti niiden järjestys. Normaalisti muuttujat visualisoitaisiin aakkosjärjestyksessä (alfanumeerisessa järjestyksessä), jolloin numerot tulisivat ennen tekstimuuttujia. Haluamme kuitenkin tässä (?), että "Yhteensä" on ennen numeroita.

```{r 1_yd_kuolemansyyt_filtterointi_faktorit}
itsemurhat_ikaryhmat_2 <- rbind(itsemurhat_ikaryhmat, itsemurhat_ikaryhmat_total) %>% 
  mutate(ika = factor(ika, levels=c("15 - 29 (Yhteensä)", "15 - 19", "20 - 24", "25 - 29")))

vakivalta_ikaryhmat_2 <- rbind(vakivalta_ikaryhmat, vakivalta_ikaryhmat_total) %>% 
  mutate(ika = factor(ika, levels=c("15 - 29 (Yhteensä)", "15 - 19", "20 - 24", "25 - 29")))

huumekuolemat_ikaryhmat_2 <- rbind(huumekuolemat_ikaryhmat, huumekuolemat_ikaryhmat_total) %>% 
  mutate(ika = factor(ika, levels=c("15 - 29 (Yhteensä)", "15 - 19", "20 - 24", "25 - 29")))
```
## Visualisointi (dodge)

Tässä visualisoinnissa esitetään erikseen eri kuolinsyiden Yhteensä-määrä ja erilliset kuolinsyyt omina palkkeinaan.

Hyödyntämällä patchwork-kirjastoa saamme yhdistettyä useita kuvioita yhteen.

```{r 1_yd_kuolemansyyt_visualisointi}
ggplot() +
  # geom_bar(data = itsemurhat_ikaryhmat_total, aes(y = total, x=as.numeric(vuosi)), stat="identity", position="dodge") +
  geom_bar(data = itsemurhat_ikaryhmat_2, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi)), position="dodge", stat="identity") + 
  labs(title = "Itsemurhiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä") +
  scale_fill_grey(start = 0.7, end = 0.15)

ggplot(vakivalta_ikaryhmat_2, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Väkivaltaan kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä") +
  scale_fill_grey(start = 0.7, end = 0.15)

ggplot(huumekuolemat_ikaryhmat_2, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Huumeisiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä") +
  scale_fill_grey(start = 0.7, end = 0.15)
```
## Visualisointi (patchwork)

Hyödyntämällä patchwork-kirjastoa saamme yhdistettyä useita kuvioita yhteen.

```{r 1_yd_kuolemansyyt_visualisointi_patchwork}
p1 <- ggplot() +
  geom_bar(data = itsemurhat_ikaryhmat_2, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi)), position="dodge", stat="identity") + 
  ylim(0, 200) +
  scale_fill_grey(start = 0.7, end = 0.15) +
  labs(title = "Itsemurhat", x = "Vuosi", y = "Kuolleet (n)", fill = "Ikäryhmä")

p2 <- ggplot(vakivalta_ikaryhmat_2, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  ylim(0, 200) +
  scale_fill_grey(start = 0.7, end = 0.15) +
  labs(title = "Väkivalta", x = "Vuosi", y = "Kuolleet (n)", fill = "Ikäryhmä")

p3 <- ggplot(huumekuolemat_ikaryhmat_2, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  ylim(0, 200) +
  scale_fill_grey(start = 0.7, end = 0.15) +
  labs(title = "Huumeet", x = "Vuosi", y = "Kuolleet (n)", fill = "Ikäryhmä")

p1 + p2 + p3 + plot_layout(ncol = 2, guides = "collect", axis_titles = "collect") & theme(legend.position = "bottom")
```

## Visualisointi (stacked)

Tässä visualisoinnissa YD-kuolemien kokonaismäärä näkyy pinoamalla erilliset kuolinsyyt yhdeksi palkiksi.

```{r 1_yd_kuolemansyyt_visualisointi_stack}
ggplot() +
  # geom_bar(data = itsemurhat_ikaryhmat_total, aes(y = total, x=as.numeric(vuosi)), stat="identity", position="dodge") +
  geom_bar(data = itsemurhat_ikaryhmat, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi)), position="stack", stat="identity") + 
  labs(title = "Itsemurhiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä") + 
  scale_fill_grey(start = 0.75, end = 0.25)

ggplot(vakivalta_ikaryhmat, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="stack", stat="identity") + 
  labs(title = "Väkivaltaan kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä") +
  scale_fill_grey(start = 0.75, end = 0.25)

ggplot(huumekuolemat_ikaryhmat, aes(fill = ika, y=kuolleet_06_23, x=as.numeric(vuosi))) +
  geom_bar(position="stack", stat="identity") + 
  labs(title = "Huumeisiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Ikäryhmä") +
  scale_fill_grey(start = 0.75, end = 0.25)
```

# 2. Pylväsdiagrammi, yd-kuolemansyyt sukupuolittain 2006-2024, absoluuttiset luvut

## Filtteröinti

```{r 2_yd_kuolemansyyt_sukupuolittain_filtterointi}
itsemurhat_sp <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli) %>% 
  summarize(kuolleet_06_23_sp = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_sp <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli) %>% 
  summarize(kuolleet_06_23_sp = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_sp <- huumekuolemat %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli) %>% 
  summarize(kuolleet_06_23_sp = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()
```

## Visualisointi

```{r 2_yd_kuolemansyyt_sukupuolittain_visualisointi}
ggplot(itsemurhat_sp, aes(fill = sukupuoli, y=kuolleet_06_23_sp, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Itsemurhiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Sukupuoli") +
  scale_fill_grey(start = 0, end = 0.5)

ggplot(vakivalta_sp, aes(fill = sukupuoli, y=kuolleet_06_23_sp, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Väkivaltaan kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Sukupuoli") +
  scale_fill_grey(start = 0, end = 0.5)

ggplot(huumekuolemat_sp, aes(fill = sukupuoli, y=kuolleet_06_23_sp, x=as.numeric(vuosi))) +
  geom_bar(position="dodge", stat="identity") + 
  labs(title = "Huumeisiin kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Sukupuoli") +
  scale_fill_grey(start = 0, end = 0.5)
```

## Taulukko

### Datan siivous

```{r}
itsemurhat_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_yht <- huumekuolemat %>% 
  filter(sukupuoli %in% c("Miehet", "Naiset")) %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

yd_kuolemat_kaikki <- rbind(itsemurhat_yht, vakivalta_yht, huumekuolemat_yht) %>% 
  tidyr::pivot_wider(names_from = c(kuolemansyy, sukupuoli), 
                     values_from = kuolleet_06_23_yht)
```


### Taulukon printtaus

```{r}
yd_kuolemat_kaikki %>% 
  rename(itsem_m = "itsemurha_Miehet", itsem_n = "itsemurha_Naiset",
         vakiv_m = "vakivalta_Miehet", vakiv_n = "vakivalta_Naiset",
         huume_m = "huumekuolema_Miehet", huume_n = "huumekuolema_Naiset")
```


# 3. Pylväsdiagrammi, jossa 15-29-vuotiaiden nuorten kuolemat 2006-2024

## Filtteröinti

```{r 3_yd_kuolemansyyt_vs_muut_filtterointi}
itsemurhat_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki_muut_yht <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "muut") %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  filter(sukupuoli %in% "Yhteensä") %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_yht <- huumekuolemat %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  filter(as.numeric(vuosi) >= 2006) %>%
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_06_23_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki <- rbind(itsemurhat_yht, vakivalta_yht, huumekuolemat_yht, kaikki_muut_yht)

kaikki_wide <- kaikki %>% 
  pivot_wider(names_from = kuolemansyy, values_from = kuolleet_06_23_yht) %>% 
  mutate(muut = muut - itsemurha - vakivalta - huumekuolema)

kaikki_long <- kaikki_wide %>% 
  pivot_longer(!c(vuosi, sukupuoli), names_to = "kuolemansyy") %>% 
  mutate(kuolemansyy = factor(kuolemansyy, levels=c("huumekuolema", "vakivalta", "itsemurha", "muut")))

```

## Visualisointi

```{r 3_yd_kuolemansyyt_vs_muut_visualisointi}
ggplot(kaikki_long, aes(fill = kuolemansyy, y=value, x=as.numeric(vuosi))) +
  geom_bar(position="stack", stat="identity") + 
  labs(title = "Eri syistä kuolleet 15-29 -vuotiaat 2006-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az, statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       fill = "Kuolemansyy") +
  scale_fill_grey()
```

# 4. Viivadiagrammi nuorten kuolemista 1970-2024, yd-kuolemansyyt ja kaikki kuolemansyyt.

## Absoluuttiset lukuarvot

### Filtteröinti

Verrattuna aiempiin vaiheisiin, tässä on pudotettu pois vuoden perusteella filtteröinti. Toisin sanottuna mukaan otetaan kaikki havainnot aineiston alkupisteestä asti. Huumekuolemat-aineisto alkaa vasta vuodesta 2006.

```{r 4_yd_kuolemansyyt_vs_muut_1970_filtterointi}
itsemurhat_yht_70 <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "itsemurha") %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

vakivalta_yht_70 <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "vakivalta") %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki_muut_yht_70 <- itsemurhat_vakivalta %>% 
  filter(kuolemansyy == "muut") %>% 
  filter(sukupuoli %in% "Yhteensä") %>% 
  mutate(kuolemansyy = "yhteensä") %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

huumekuolemat_yht_70 <- huumekuolemat %>% 
  filter(sukupuoli %in% c("Yhteensä")) %>% 
  group_by(vuosi, sukupuoli, kuolemansyy) %>% 
  summarize(kuolleet_yht = sum(kuolleet_06_23, na.rm = TRUE)) %>% 
  ungroup()

kaikki_70 <- rbind(itsemurhat_yht_70, vakivalta_yht_70, huumekuolemat_yht_70, kaikki_muut_yht_70) %>% 
  mutate(kuolemansyy = factor(kuolemansyy, levels=c("yhteensä", "itsemurha", "huumekuolema", "vakivalta")))

# kaikki_wide_70 <- kaikki_70 %>%
#   pivot_wider(names_from = kuolemansyy, values_from = kuolleet_yht) %>%
#   mutate(muut = muut - itsemurha - vakivalta - huumekuolema)
# 
# kaikki_long_70 <- kaikki_wide_70 %>%
#   pivot_longer(!c(vuosi, sukupuoli), names_to = "kuolemansyy")

```


### Visualisointi

```{r 4_yd_kuolemansyyt_vs_muut_1970_visualisointi}
ggplot(data = kaikki_70, aes(x = as.numeric(vuosi), y = kuolleet_yht, group = kuolemansyy)) +
  geom_line(aes(color=kuolemansyy)) + 
  labs(title = "Eri syistä kuolleet 15-29 -vuotiaat 1969-2023",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az, statfin_ksyyt_pxt_12d9)",
       x = "Vuosi",
       y = "Kuolleita (n)",
       colour = "Kuolemansyy") +
  scale_color_grey()
```
## Suhteutettuna ikäluokan kokoon

### ASDR

> Ikäryhmittäinen kuolleisuusluku (Age Specific Death Rate, ASDR) vastaa ikäryhmittäistä hedelmällisyyslukua niin hyvien kuin huonenkin ominaisuuksiensa osalta. Se on täsmällinen mittaluku, mutta se pilkkoo tiedon kuolleisuudesta niin moneen pieneen palaseen, että kokonaiskuvaa on vaikea saada. Esimerkiksi 25-29-vuotiaille ikäryhmittäinen kuolleisuusluku lasketaan seuraavanlaisessa kaavalla:
>
>$$
>ASDR = \frac{\text{25-29 vuotiaana kuolleet vuonna A}}{\text{25-29-vuotiaiden keskiväkiluku vuonna A}} \times 1000
>$$
>
> (Suomen väestö -teos)

Kategorisoidaan ensin 1 ikävuoden välein otetut keskiväkiluvut aiemmin käytettyihin kategorioihin 15 - 19, 20 - 24 ja 25-29.

```{r}
statfin_vaerak_pxt_11s1 <- statfin_vaerak_pxt_11s1 %>% 
  janitor::clean_names()

keskivakiluvut <- statfin_vaerak_pxt_11s1 %>% 
  mutate(ikaryhma = case_when(
    ika %in% as.character(15:19) ~ "15 - 19",
    ika %in% as.character(20:24) ~ "20 - 24",
    ika %in% as.character(25:29) ~ "25 - 29",
    .default = "muut"
  )) %>% 
  group_by(vuosi, sukupuoli, ikaryhma) %>% 
  summarize(keskivakiluku_ikaryhma = sum(keskivakiluku)) %>% 
  ungroup()

keskivakiluvut_15_29 <- statfin_vaerak_pxt_11s1 %>% 
  mutate(ikaryhma = "15 - 29") %>% 
  group_by(vuosi, sukupuoli, ikaryhma) %>% 
  summarize(keskivakiluku_ikaryhma = sum(keskivakiluku)) %>% 
  ungroup()
```

Lasketaan sitten kuolleiden määrän ja keskiväkiluvun suhteesta saatava ASDR.

```{r}
keskivakiluvut_15_29 <- keskivakiluvut_15_29 %>% 
  filter(sukupuoli == "Yhteensä") %>% 
  select(vuosi, keskivakiluku_ikaryhma)

kaikki_70_asdr <- left_join(kaikki_70, keskivakiluvut_15_29, by = join_by("vuosi" == "vuosi")) %>% 
  filter(as.numeric(vuosi) > 1981) %>% 
  mutate(asdr = (kuolleet_yht / keskivakiluku_ikaryhma) * 1000)
```

### Visualisointi

```{r 4_yd_kuolemansyyt_vs_muut_1970_visualisointi_asdr}
ggplot(data = kaikki_70_asdr, aes(x = as.numeric(vuosi), y = asdr, group = kuolemansyy)) +
  geom_line(aes(color=kuolemansyy)) + 
  labs(title = "Eri syistä kuolleet 15-29 -vuotiaat 1981-2023 (ikävakioitu)",
       caption = "Lähde: Tilastokeskus / StatFin (statfin_ksyyt_pxt_11az, statfin_ksyyt_pxt_12d9, statfin_vaerak_pxt_11s1)",
       x = "Vuosi",
       y = "Per 1000 samanikäistä",
       colour = "Kuolemansyy") +
  scale_color_grey()
```

# Viittaukset

```{r}
print(citation("pxweb"), bibtex = FALSE)

print(citation("ggplot2"), bibtex = FALSE)

print(citation("dplyr"), bibtex = FALSE)

print(citation("tidyr"), bibtex = FALSE)

print(citation("janitor"), bibtex = FALSE)
```


# Session info

Tällä varmistetaan se, että tieto pakettien versioista tulee kirjattua johonkin.

```{r}
sessionInfo()
```

